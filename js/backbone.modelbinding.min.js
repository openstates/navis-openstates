// Backbone.ModelBinding v0.4.1
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT Liscene
//
// Documentation and Full Licence Availabe at:
// http://github.com/derickbailey/backbone.modelbinding
Backbone.ModelBinding=function(k,j,n){modelBinding={version:"0.4.1",bind:function(a,b){a.modelBinder=new ModelBinder(a,b);a.modelBinder.bind()},unbind:function(a){a.modelBinder&&a.modelBinder.unbind()}};ModelBinder=function(a,b){this.config=new modelBinding.Configuration(b);this.modelBindings=[];this.elementBindings=[];this.bind=function(){var b=modelBinding.Conventions,e;for(e in b)if(b.hasOwnProperty(e)){var c=b[e];c.handler.bind.call(this,c.selector,a,a.model,this.config)}};this.unbind=function(){j.each(this.elementBindings,
function(b){b.element.unbind(b.eventName,b.callback)});j.each(this.modelBindings,function(b){b.model.unbind(b.eventName,b.callback)})};this.registerModelBinding=function(b,a,c){a="change:"+a;b.bind(a,c);this.modelBindings.push({model:b,eventName:a,callback:c})};this.registerElementBinding=function(b,a){b.bind("change",a);this.elementBindings.push({element:b,eventName:"change",callback:a})}};modelBinding.Configuration=function(a){this.bindingAttrConfig={};j.extend(this.bindingAttrConfig,modelBinding.Configuration.bindindAttrConfig,
a);if(this.bindingAttrConfig.all){a=this.bindingAttrConfig.all;delete this.bindingAttrConfig.all;for(var b in this.bindingAttrConfig)this.bindingAttrConfig.hasOwnProperty(b)&&(this.bindingAttrConfig[b]=a)}this.getBindingAttr=function(b){return this.bindingAttrConfig[b]};this.getBindingValue=function(b,a){var c=this.getBindingAttr(a);return b.attr(c)}};modelBinding.Configuration.bindindAttrConfig={text:"id",textarea:"id",password:"id",radio:"name",checkbox:"id",select:"id",number:"id",range:"id",tel:"id",
search:"id",url:"id",email:"id"};modelBinding.Configuration.store=function(){modelBinding.Configuration.originalConfig=j.clone(modelBinding.Configuration.bindindAttrConfig)};modelBinding.Configuration.restore=function(){modelBinding.Configuration.bindindAttrConfig=modelBinding.Configuration.originalConfig};modelBinding.Configuration.configureBindingAttributes=function(a){a.all&&(this.configureAllBindingAttributes(a.all),delete a.all);j.extend(modelBinding.Configuration.bindindAttrConfig,a)};modelBinding.Configuration.configureAllBindingAttributes=
function(a){var b=modelBinding.Configuration.bindindAttrConfig;b.text=a;b.textarea=a;b.password=a;b.radio=a;b.checkbox=a;b.select=a;b.number=a;b.range=a;b.tel=a;b.search=a;b.url=a;b.email=a};StandardBinding=function(){var a={},b=function(b){var a=b[0].tagName.toLowerCase();if(a=="input"&&(a=b.attr("type"),a==void 0||a==""))a="text";return a};a.bind=function(a,e,c,l){var d=this;e.$(a).each(function(){var a=e.$(this),f=b(a),i=l.getBindingValue(a,f),m=function(a,b){var d={};d[a]=b;c.set(d)};d.registerModelBinding(c,
i,function(b,d){a.val(d)});d.registerElementBinding(a,function(b){m(i,e.$(b.target).val())});f=c.get(i);typeof f!=="undefined"&&f!==null?a.val(f):(f=a.val())&&m(i,f)})};return a}(k);SelectBoxBinding=function(){return{bind:function(a,b,h,e){var c=this;b.$(a).each(function(){var a=b.$(this),d=e.getBindingValue(a,"select"),g=function(a,b,d){var c={};c[a]=b;c[a+"_text"]=d;h.set(c)};c.registerModelBinding(h,d,function(b,d){a.val(d)});c.registerElementBinding(a,function(a){var c=b.$(a.target),a=c.val(),
c=c.find(":selected").text();g(d,a,c)});var f=h.get(d);typeof f!=="undefined"&&f!==null&&a.val(f);if(a.val()!=f){var f=a.val(),i=a.find(":selected").text();g(d,f,i)}})}}}(k);RadioGroupBinding=function(){return{bind:function(a,b,h,e){var c=this,l=[];b.$(a).each(function(){var a=b.$(this),g=e.getBindingValue(a,"radio");if(!l[g]){l[g]=true;var f=e.getBindingAttr("radio");c.registerModelBinding(h,g,function(a,c){b.$("input[type=radio]["+f+"="+g+"][value="+c+"]").attr("checked","checked")});var i=function(a,
b){var c={};c[a]=b;h.set(c)},m=function(a){a=b.$(a.currentTarget);a.is(":checked")&&i(g,a.val())};b.$("input[type=radio]["+f+"="+g+"]").each(function(){var a=n(this);c.registerElementBinding(a,m)});a=h.get(g);typeof a!=="undefined"&&a!==null?b.$("input[type=radio]["+f+"="+g+"][value="+a+"]").attr("checked","checked"):(a=b.$("input[type=radio]["+f+"="+g+"]:checked").val(),i(g,a))}})}}}(k);CheckboxBinding=function(){return{bind:function(a,b,h,e){var c=this;b.$(a).each(function(){var a=b.$(this);e.getBindingAttr("checkbox");
var d=e.getBindingValue(a,"checkbox"),g=function(a,b){var c={};c[a]=b;h.set(c)};c.registerModelBinding(h,d,function(b,c){c?a.attr("checked","checked"):a.removeAttr("checked")});c.registerElementBinding(a,function(a){a=b.$(a.target).is(":checked")?true:false;g(d,a)});if(h.attributes.hasOwnProperty(d)){var f=h.get(d);typeof f!=="undefined"&&f!==null&&f!=false?a.attr("checked","checked"):a.removeAttr("checked")}else f=a.is(":checked")?true:false,g(d,f)})}}}(k);DataBindBinding=function(a,b,h){var e={"default":""};
modelBinding.Configuration.dataBindSubst=function(a){this.storeDataBindSubstConfig();b.extend(e,a)};modelBinding.Configuration.storeDataBindSubstConfig=function(){modelBinding.Configuration._dataBindSubstConfig=b.clone(e)};modelBinding.Configuration.restoreDataBindSubstConfig=function(){if(modelBinding.Configuration._dataBindSubstConfig)e=modelBinding.Configuration._dataBindSubstConfig,delete modelBinding.Configuration._dataBindSubstConfig};modelBinding.Configuration.getDataBindSubst=function(a,b){var d=
b;b===void 0&&(d=e.hasOwnProperty(a)?e[a]:e["default"]);return d};setOnElement=function(a,b,d){d=modelBinding.Configuration.getDataBindSubst(b,d);switch(b){case "html":a.html(d);break;case "text":a.text(d);break;case "enabled":a.attr("disabled",!d);break;case "displayed":a[d?"show":"hide"]();break;case "hidden":a[d?"hide":"show"]();break;default:a.attr(b,d)}};splitBindingAttr=function(a){var e=[],a=a.attr("data-bind").split(";");b.each(a,function(a){a=h.trim(a).split(" ");a.length==1&&a.unshift("text");
e.push({elementAttr:a[0],modelAttr:a[1]})});return e};return{bind:function(a,e,d){var g=this;e.$(a).each(function(){var a=e.$(this),c=splitBindingAttr(a);b.each(c,function(b){g.registerModelBinding(d,b.modelAttr,function(c,d){setOnElement(a,b.elementAttr,d)});setOnElement(a,b.elementAttr,d.get(b.modelAttr))})})}}}(k,j,n);modelBinding.Conventions={text:{selector:"input:text",handler:StandardBinding},textarea:{selector:"textarea",handler:StandardBinding},password:{selector:"input:password",handler:StandardBinding},
radio:{selector:"input:radio",handler:RadioGroupBinding},checkbox:{selector:"input:checkbox",handler:CheckboxBinding},select:{selector:"select",handler:SelectBoxBinding},databind:{selector:"*[data-bind]",handler:DataBindBinding},number:{selector:"input[type=number]",handler:StandardBinding},range:{selector:"input[type=range]",handler:StandardBinding},tel:{selector:"input[type=tel]",handler:StandardBinding},search:{selector:"input[type=search]",handler:StandardBinding},url:{selector:"input[type=url]",
handler:StandardBinding},email:{selector:"input[type=email]",handler:StandardBinding}};return modelBinding}(Backbone,_,jQuery);
